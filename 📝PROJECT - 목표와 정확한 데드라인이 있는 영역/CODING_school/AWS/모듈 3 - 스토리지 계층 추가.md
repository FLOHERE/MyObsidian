# 섹션 1 : 가장 간단한 아키텍쳐
- 정적 웹사이트를 만들자!

# 섹션 2 : Amazon S3 사용
## Amazon S3 (Simple Storage Service)
- 객체 스토리지 서비스
	- 대량의 비정형 데이터 -> 무제한 저장
	- 데이터 파일이 사용자가 정의한 버킷에 객체로 저장됨
		- 버킷 : 데이터 파일을 객체 형태로 저장하는곳(버킷 이름은 모든 AWS고객 계정에서 고유해야 함)
	- 단일 객체의 최대 파일 크기 : 5TB
	- 모든 객체에는 REST 액세스 가능한 전역 고유 URL(범용 네임 스페이스)가 있음
	- 모든 객체에는 키, 버전 ID, 값, 메타데이터, 하위 리소스 있음
- 특징
	1. 키 : 객체에 할당하는 이름
		- 객체를 검색할 수 있다.
		- 버킷 루트에 대한 상대적인 전체 경로가 포함됨
	2. 객체의 값 : 실제 컨텐츠
		- 수정 불가 -> 외부에서 변경 후 객체 재 업로드 필요
	3. 메타데이터 : 사용자가 정의 할 수 있는 사용자 정의 메타데이터가 있음
	4. 하위 리소스 : 추가적인 객체별 정보 저장 가능

>[!note] 메타데이터란?
>데이터에 대한 데이터로, 데이터를 설명하거나 관리하기 위한 정보

## Amazon S3의 이점
1. 내구성 : 데이터가 손실 되지 않도록 보장(99.999% 내구성)
	1. 여러 시설에서 여러 디바이스에 객체 중복 저장
	2. 중복 손실 방지 + 복구 = 여러 디바이스에 동시 장애 발생 방지
2. 가용성 : 필요 할때 데이터에 빠르게 엑세스 할 수 있음(99% 가용성)
3. 확장성 : 사실상 무제한의 용량 제공(5TB 이하의 모든 단일 객체)
	- 데이터 접근 제어 방법으로 보안까지 좋음
4. 보안 : 세분화된 액세스 제어 기능 제공
5. 성능 : 다양한 디자인 패턴에서 지원됨. 밀리초 단위의 첫 바이트 지연 시간 제공 -> 성능 좋음
	- 일반적인 데티터 접근 방식
		1. 캐싱
		2. 단기간에 요청 트래픽이 몰려도 수신 객체에 대한 재시도 및 초과 로직
			- 요청을 보냈는데 응답 없으면 재시도, 시간이 너무 오래 걸리면 중단 한다.
		3. 수평 확장 + 요청 병렬 처리 -> 네트워크 전반에서 처리량을 높임

## 사용 사례
### 1. 웹 컨텐츠 및 미디어 저장 및 배포
- 동영상, 사진 등 업로드 및 다운로드를 호스팅(미디어 호스팅) 하는 중복 방식의 확장 가능하고 가용성 높은 인프라 구축
- 각 객체에 고유한 HTTP URL이 있어 Amazon S3에서 직접 전송함
- 수요의 급증 해결을 위해 대역폭이 필요한 웹 컨텐츠 호스팅에 적합
- Amazon Cloud Front : 컨텐츠 전송 네트워크의 오리진 스토어 역할(컨텐츠의 원본을 저장)
	- 컨텐츠 전송 네트워크(CDN) : 사용자에게 컨텐츠(이미지, 동영상 등)을 빠르게 전달하기 위해 전 세계에 캐시 서버를 분산 배치한 시스템
		- ex_) 사용자가 서울 근처면 서울 근처 CDN에서 서버 컨텐츠를 받음
	- 프로비저닝 : 서버를 생성하고 OS, 네트워크 등 설정 세팅
		- 시스템 동작에 필요한 것들을 준비하는 과정

#### 버킷 및 객체 보안
- 새로 생성된 S3버킷과 객체는 비공개, 보호됨
- <사용 사례> : S3에서 데이터를 공유해야 하는 경우
	- 데이터 엑세스 관리 및 제어
	- 최소 권한 원칙을 따름
- 데이터 엑세스 제어를 위한 도구 및 옵션
	1. 퍼블릭 액세스 차단 기능 : 새 버킷에 대해 기본적으로 활성화됨, 관리 쉬움
		- 데이터의 의도치 않은 노출을 간단하게 방지
	2. IAM 정책 : 사용자가 IAM 사용 -> 인증
		- 특정 버킷 및 객체에 액세스 할 수 있는 사용자 또는 역할을 지정
	3. 버킷 정책 : 특정 객체 또는 버킷에 대한 액세스 정의 가능
		1. IAM을 사용하여 인증 할 수 없는 경우에 사용
		2. AWS계정에 액세스 권한 부여 OR 데이터에 대한 퍼블릭 또는 익명 엑세스 권한 부여 -> 버킷 정책 구성
		3. 사용자에게 연결된 자격 증명 기반 정책(권한, 역할 같은거)에서 부여한 권한이 있는 사용자의 경우에도 액세스 제한됨
	4. ACL(액세스 제어 목록) : 래거시 액세스 제어 매커니즘
	5. S3액세스 포인트 : 각 애플리케이션에 특정한 이름 및 권한 사용 -> 액세스 구성
		1. 사용자마다 권한 설정을 맞춤형으로 커스텀하여 S3 버킷에 접근 가능하다는 뜻
	6. 미리 성명된 URL : 임시 URL사용 -> 다른 사용자에게 시간이 제한된 액세스 권한 부여 가능
	7. AWS Trusted Advisor : 버킷 권한 확인 (무료로 제공되는 기능)

#### 액세스 구성을 위한 세가지 일반적인 접근 방식
- 버킷 및 객체의 사용 사례에 적합한 보안 설정을 구성


![[Pasted image 20251020112033.png]]

1. 기본 보안 설정 : 새로 생성, 수정되지 않은 버킷에 액세스 할 수 있는것은 계정 관리자와 AWS 계정 루트 사용자 뿐.
	- 리소스 소유자 -> 다른 사용자에게 특정 액세스 권한 부여 가능
	  but! 해당 권한이 부여되지 않은 사용자는 접근 불가
2. 퍼블릭 액세스 보안 설정 : 보안 설정 비활성화, 누구나 버킷에 저장된 객체에 공개적으로 접근 가능
	1. 웬만하면 쓰지 마라
3. 보안 설정에 적용되는 액세스 정책 : 제어된 액세스 제공

#### 객체 암호화 고려

>[!note] 인코딩과 디코딩
>- 인코딩 : 데이터를 전송 가능한 형태로 변환
>- 디코딩 : 원래 데이터 형태로 읽을 수 있도록 복원

- 암호화는 읽을 수 없는 보안 키로 데이터를 인코딩
	- 보안키가 있어야 데이터 디코딩 가능
	- AWS Key Management Service(AWS KMS) 사용하여 보안 키 관리
- 서버측 암호화
	- 기본 암호화 옵션
	- 객체를 디스크에 저장 전 암호화, 사용자가 객체를 다운할때 해당 객체 복호화 함
- 클라이언트 측 암호화 
	- 클라이언트 측 데이터를 암호화 -> 암호화 된 데이터를 S3에 업로드
	- 사용자가 암호화 프로세스 관리
- 데이터를 암호화 하는 방법(2가지)
	1. 기본 암호화 옵션(서버측 암호화)
		1. 서버측 암호화 활성화
		2. S3가 객체 저장 전 암호화
		3. 객체 다운로드시 복호화
	2. 클라이언트 측 암호화
		1. 클라이언트측 암호 활성화(사용자가 암호화 프로세스, 키 등 관리)
		2. 키로 데이터 암호화(데이터 저장과는 다른 방식)

## 2. 정적 웹사이트 호스팅
- HTML, 파일, 이미지, 동영상 및 클라이언트 측 스크립트를 포함한 정적 컨텐츠 지원
- 웹사이트 호스팅용 S3 버킷 구성 -> 웹 사이트 컨텐츠를 버킷에 업로드
- 가상 머신 실행 필요 X, 웹사이트 호스팅 가능

>[!note] 그럼 동적 웹사이트는?
>다른 서비스를 이용하도록.
>-> PHP, JSP등 서버 측 스크립트에 대한 응답으로 실행되는 데이터베이스 쿼리를 비롯한 서버측 처리에 의존

### 모범 사례 : 버전 관리
- 성능 저하 없이 실수로 덮어쓰거나 삭제 방지
- 모든 업로드에서 새 버전 생성
- 삭제된 객체를 쉽게 검색할 수 있도록 함
	- or 이전 버전으로 롤백
- S3 버킷의 세가지 가능한 상태
	1. 기본값 : 버전 관리가 활성화 되어 있지 않음
	2. 버전 관리 활성화 됨
	3. 버전 관리 중단됨
		- 버전관리 : 같은 버킷에 객체의 여러 변형 버전을 유지하는 방법
		- 모든 버전의 객체를 모두 보존, 검색 및 복원 가능
		- 버전 관리 미사용, 버전 관리 활성화, 버전 관리 일시중지 상태로 나눠짐
			- 버전 관리 활성화 후 "버전 관리 되지 않음" 상태로 전환 불가 

### 교차 원본 리소스 공유(CORS)
- Cross Origin Resource Sharing : 웹 브라우저가 다른 서버(도메인)에 있는 데이터(API, 이미지 파일 등)에 접근 가능 여부에 대한 규칙
- CROS구성(교차 오리진 요청을 허용하도록 버킷 구성 시 생성 해야함)
	- 버킷에 엑세스 하도록 허용할 오리진
	- 각 오리진에 대해 지원할 작업(HTTP 메서드) -> PUT, DELETE 요청 등

## 3. 연산 및 분석용 데이터 스토어

![[Pasted image 20251020120211.png]]

- 금융 거래 분석, 클릭 스트림 분석(사용자가 어디를 클릭하고 어디로 이동하는지 트래킹), 미디어 트랜스코딩(미디어 파일을 다른 포맷, 해상도, 비트레이트로 변환 - PC -> 모바일) 등 대규모 분석을 위해 사용가능
- Amazon QuickSight : 처리된 데이터에서 유용한 분석 정보를 얻을수 있음
- 스팟 인스턴스 : 클라우드 제공자가 남은 용량을 할인된 가격으로임시 제공하는 갓ㅇ 서버
- Amazon EMR 클러스터 : AWS에서 제공하는 대규모 데이터 처리용 관리형 클러스터
	- 하둡, 스파크 등..
	- 클러스터 : 여러대의 서버가 모여 하나의 시스템 처럼 데이터 처리

## 4. 중요한 데이터의 백업 및 아카이브

![[Pasted image 20251020120749.png]]

- 뛰어난 내구성 및 확장성 덕분에 백업 및 아카이브 도구로 유용

### Amazon S3 데이터 일관성 모델
- 모든 리전에 있는 모든 신규 및 기존 객체에 강력한 일관성 제공
	- S3버킷에 있는 객체의 모든 GET, LIST, PUT 작업에 대해 쓰기 후 읽기 일관성을 제공
	- 일관성 모델 사용시 빅데이터 워크로드에 이점 있음
- 버킷 구성에는 최종적으로 일관성 있는 모델 포함

>[!note] 일관성과 고 가용성
>- 일관성 : 데이터 읽기 or 쓰기 시 모든 사용자가 보는 값이 최신 상태와 일치
>- 고 가용성 : 시스템 장애 발생시에도 중단 없이 계속 작동

# 섹션 3 : Amazon S3에 데이터 저장
## Amazon S3 / Amazon S3 Glacier 스토리지 클래스
### 1. S3 standard : 자주 액세스 하는 데이터 
- 높은 내구성(데이터 손실이 없다.)과 가용성
- 짧은 지연시간 + 많은 처리량
- 클라우드 애플리케이션, 동적 웹사이트, 컨텐츠 배포, 모바일 게임, 빅데이터 분석 등에 적합
- 최소 3개의 가용 영역에 걸체 내구성 분석
### 2. S3 Standard IA(Infrequent Access) : 수명이 길고 자주 액세스 하지 않는 데이터
- Amazon S3 Standard의 모든 이점 제공
- 오래된 이미지 / 오래된 로그 파일 등 저장
- 저장된 모든 데이터에 30일의 최소 스토리지 요금 적용
- 데이터를 검색 비용 : S3 Standard-IA > S3 Standard
### 3. S3 One Zone IA : 수명이 길고, 자주 엑세스 X, 중요하지 않은 데이터
- 단일 가용 영역에 데이터 저장
- 저렴한 옵션
- 가용성 및 복원력이 필요하지 않는 고객에게 적합
- 온프레미스 데이터 or 쉽게 다시 생성 할수 있는 데이터의 보조 백업 복사본 저장시 좋은 선택
### 4. Amazon S3 Glacier or Deep Archive : 거의 액세스 하지 않는 데이터 보관
- 아카이브를 위한 안전하고 내구성이 있으며 저렴한 스토리지 클래스
- 온프레미스 솔루션과 비슷하거나 더 저렴한 비용
- 원하는 양의 데이터를 안정적으로 저장
	- 신속 검색  : 1~5분
	- 표준 검색 : 3~5시간
	- 대량 검색 : 5~12시간
### 5. Amazon S3 Intelligent Tierring : 데이터 액세스 패턴에 따라 스토리지 등급 간에 객체를 자동으로 이동
- 성능 또는 운영 오버헤드 X, 가장 비용 효율적
- 데이터 자동 이동 -> 비용 최적화
- 객체당 월별 모니터링 및 자동화 요금 소액 지불 시 S3가 S3 Intelligent-Tierirng을 통해 객체의 액세스 패턴 모니터링 함
- 30일 이상 데이터에 접근하지 않으면 IA티어로 이동
	- IA티어의 객체에 엑세스 하면 이 객체는 자동으로 Frequent Access티어로 다시 이동
	- 검색 요금 없음
	- 티어간 객체 이동때도 요금 없음

## Amazon S3 수명 주기 정책
- 사용 기간을 기준으로 객체를 삭제 or 이동 하도록 Amazon S3수명 주기 정책 구성
1. Amazon S3 Standard에서 30일 동안 데이터 사용 안함
2. Amazon S3 Standard - IA로 넘어감
3. 데이터를 사용 안한지 60일 경과
4. Amazon S3 Glacier로 이동
5. 데이터를 사용 안한지 1년 경과
6. 삭제

## Amazon S3 비용
- 무료
	- 인터넷에서 Amazon S3로의 데이터 전송
	- 같은 AWS 리전 내에서 S3 버킷 간에 또는 S3에서 다른 서비스로 데이터 전송
	- Amazon CloudFront 로의 전송
	- DELETE , CANCLE 요청
- 유료
	- 저장된 객체의 GB(매달) 리전 및 스토리지 등급별로 요금이 다름
	- 다른 리전 또는 인터넷으로 전송
	- PUT, COPY, POST ,LIST , GET, SELECT, 수명 주기 전환, 데이터 검색 요청
- 요금 결정 사항
	1. 스토리지 요금 요청 및 데이터 검색 요금
	2. 데이터 전송 및 전송 가속화 요금
	3. 데이터 관리 기능 요금

# 섹션4 : Amazon S3 안팎으로 데이터 이동
## 1. AWS Management Console
- 브라우저 사용 -> 업로드 또는 다운로드
- 가장 간단한 방법
- 복사 파일을 버킷으로 끌어다 놓는 옵션(마법사 기반 접근 방식)

## 2. AWS Command Line Interface
- 터미널 명령 프롬프트 or 스크립트에서 호출 -> 업로드 또는 다운로드
- ex_)
	1. CLI 호출 할 aws지정 후 서비스 지정
	2. 명령 실행(copy 등)
	3. s3://AWSDOC-EXAMPLE-BUCKET/test.txt 파라미터는 로컬파일 실행 파일을 업로드 해야하는 버킷과 객체값(컨텐츠)을 저장해야 한는 키를 나타냄

## 3. AWS 도구 및 SDK
- 프로그래밍 방식으로 객체 이동