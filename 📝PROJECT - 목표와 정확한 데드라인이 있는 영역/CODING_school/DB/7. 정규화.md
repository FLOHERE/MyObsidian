- 학습 목표
	- 이상현상 : 데이터베이스 설계 과정에서 발생할수 있는 이상현상의 종류와 원인 이해
	- 함수 종속성 : 함수 종속성의 개념을 이해, 관련 규칙을 이해
	- 정규화 : 함수 종속성을 이용한 정규화 과정을 이해
- 학습 내용
	1. 이상 현상
	2. 함수 종속성
	3. 정규화
	4. 부동산 데이터베이스 정규화 실습

## 01)이상현상
### 01-1) 이상 현상의 개념
- 잘못 설계된 테이블로 삽입, 삭제, 수정과 같은 데이터 조작을 할경우
	- 이상현상(anomaly) 발생
- 잘못 설계된 데이터 베이스가 일으키는 이상현상
	- 삭제이상(deletion anomaly)
		- 투플 삭제 -> 같이 저장된 다른 정보까지 삭제
		- 연쇄삭제(triggered deletion) 문제 발생
	- 삽입 이상(insertion anomaly)
		- 투플 삽입 ->특정 속성에 해당하는 값이 없어-> NULL 값 입력 필요
		- NULL 값은 테이블에 가능한 없어야함
		- NULL 값 문제 발생
	- 수정이상(update/modification anomaly) or 갱신 이상
		- 투플 수정시 중복된 데이터의 일부만 수정 -> 불일치 발생
		- 불일치(inconsistency) 문제 발생
- 테이블 조작시 문제 발생

### 01-3) 수정된 계절학기 수강 테이블
- 테이블의 구조 수정 -> 이상현상 발생X
![[Pasted image 20240621181008.png]]

| 질의 내용                      | SQL 문                                                                                                                            |
| -------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| 계절학기를 듣는 학생의 학번과 수강하는 과목은? | SELECT sid, class<br><br>FROM SummerEnroll;                                                                                      |
| C 강좌의 수강료는?                | SELECT price<br><br>FROM SummerPrice<br><br>WHERE class=C;                                                                       |
| 수강료가 가장 비싼 과목은?            | SELECT DISTINCT class<br><br>FROM SummerPrice<br><br>WHERE price=(SELECT MAX(price)<br>                       FROM SummerPrice); |
| 계절학기를 듣는 학생 수와 수강료 총액은?    | SELECT count(\*), SUM(price)<br><br>FROM SummerPrice, SummerEnroll<br><br>WHERE SummerPrice.class=SummerEnroll.class;            |
## 02) 함수 종속성
- 함수 종속성의 개념
- 함수 종속성의 다이어그램
- 함수 종속성 규칙
- 함수 종속성 기본키
- 이상현상과 결정자
- 함수 종속성 예제

### 02-1) 함수 종속성의 개념
- 의존성이 존재
	- 어떤 속성 A 의 값을 알면, 다른 속성 B의 값이 유일하게 정해지는것.
	- 속성 B는 속성 A에 종속한다(dependent)
	- 속성 A는 속성 B에 종속한다(determine)
- 'A->B' 꼴로 표기
	- A를 B의 결정자(determinant)라고 함.

- 학생 수강성적 릴레이션에서 종속 관계에 있는 예
	- 학생 번호 -> 학생이름
	- 학생 번소 -> 주소
	- 강좌 이름 -> 강의실
	- 학과 -> 학과 사무실
- 종속하지 않는 예
	- 학생이름 -> 강좌 이름
	- 학과 -> 학생 번호
	- ex_) 박지성 -> 데베, 자료구조 / 컴퓨터과 -> 501,502
- 종속하는 것처럼 보이지만 주의 깊게 보면 그렇지 않은 예
	- 동명이인일 경우
	- 학생이름 -> 학과
	- ex_) 김연아(동명이인) -> 컴퓨터 학과, 체육학과
학생수강성적

| 학생번호 | 학생이름 | 주소       | 학과   | 학과사무실   | 강좌이름   | 강의실     | 성적  |
| ---- | ---- | -------- | ---- | ------- | ------ | ------- | --- |
| 501  | 박지성  | 영국 맨체스터  | 컴퓨터과 | 공학관 101 | 데이터베이스 | 공학관 110 | 3.5 |
| 401  | 김연아  | 대한민국 서울  | 체육학과 | 체육관 101 | 데이터베이스 | 공학관 110 | 4.0 |
| 402  | 장미란  | 대한민국 강원도 | 체육학과 | 체육관 101 | 스포츠경영학 | 체육관 103 | 3.5 |
| 502  | 추신수  | 미국 클리블랜드 | 컴퓨터과 | 공학관 101 | 자료구조   | 공학관 111 | 4.0 |
| 501  | 박지성  | 영국 맨체스터  | 컴퓨터과 | 공학관 101 | 자료구조   | 공학관 111 | 3.5 |

### 02-2) 함수 종속성 다이어그램
- 함수 종속성 다이어그램(functional dependency diagram)
	- 함수 종속성을 나타내는 표기법
		- 릴레이션의 속성 : 직사각형
		- 속성간의 함수 종속성 : 화살표
		- 복합 속성 : 직사각형으로 묶어서 그림
![[Pasted image 20240621182605.png]]

### 02-3) 함수 종속성 규칙
- 함수 종속성 규칙
	- {부분집합, 증가, 이행} 규칙
	- (\* 반사/확대/이행의 공리)
		- 공리에서부터 {결합, 분해, 유사이행}규칙이라는 부수적 규칙 유도 가능
![[Pasted image 20240621182957.png]]

- 예시

| 적용 규칙   | 사례                        | 설명                                                                                                                        |
| ------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| 부분집합 규칙 | (학과, 주소)- 학과              | 학과는 (학과, 주소)의 부분집합 속성이므로, (학과, 주소)- 학과' 성립                                                                                |
| 증가 규칙   | (학생번호, 강좌이름)-(학생이름, 강좌이름) | '학생번호 학생이름'이므로 강좌이름을 추가하여, (학생번호, 강좌이름)- (학생이름, 강좌이름) 성립                                                                  |
| 이행 규칙   | 학생번호-*<br><br>학과사무실       | '학생번호 -> 학과, '학과 학과사무실'이므로 이행 규칙을 적용하여, '학생번호 학과사무실' 성립                                                                   |
| 결합 규칙   | 학생번호<br><br>(학생이름, 주소)    | 학생번호- 학생이름, '학생번호 주소'이므로 결합 규칙을 적용하여, 학생번호- (학생이름, 주소) 성립                                                                 |
| 분해 규칙   | 학생번호 - 학생이름, 학생번호 주소      | '학생번호 (학생이름, 주소)'이므로 분해하여,<br><br>'학생번호- 학생이름, 학생번호 주소 성립                                                                 |
| 유사이행 규칙 | (강좌이름, 학생이름)- 성적          | '학생이름 학생번호(학생이름이 같은 경우가 없다고 가정한다).<br><br>(강좌이름, 학생번호) - 성적이므로 유사이행 규칙을 적용하여, <br>(강좌이름, 학생이름)- 성적 성립<br>(\*동명이인이 없다는 가정) |

### 02-4) 함수 종속성과 기본키
- 릴레이션의 함수 종속성 파악을 위해 기본키를 찾아야함
- 기본키의 역할을 알면 이상현상을 제거하는 정규화 과정을 쉽게 이해
	- 중복되는 투플의 릴레이션이 없다면 이를 기본키처럼 사용

- ==이상현상은 한개의 릴레이션에 두개 이상의 정보가 포함되어 있을때 나타남.==
	- ==기본키가 아니면서 결정자인 속성이 있을때 발생==
- 학생 수강성적 릴레이션의 기본키(학생번호, 강좌 이름)
	- 한 릴레이션에 포함되어 이상현상 발생
	- 학과, 학생번호, 강좌이름은 기본키가 아니면서 결정자인 예 -> 문제 발생
![[Pasted image 20240621183544.png]]

### 02-5) 이상현상과 결정자
- 이상현상을 없애려면 릴레이션 분해
	1. (강좌이름, 강의실)을 분리
	2. (학생번호, 강좌이름, 성적) 분리
	3. (학과, 학과사무실)을 분리
![[Pasted image 20240621183725.png]]

- 학생 수강성적 릴레이션 부분 분해
	- 부분 릴레이션 결정자 -> 남겨두어야 함
	- 원래 릴레이션과 관계 형성
	1. 학생 수강성적 릴레이션에서 (강좌이름, 강의실)분리
		- 학생 수강 성적1(학생번호, 학생이름, 학과, 주소, 강좌이름, 성적, 학과 사무실)
		- 강의실(강좌이름, 강의실)
	2. 학생 수강성적 1 릴레이션에서 (학생 번호, 강좌이름, 성적)분리
		- 학생학과(학생번호, 학생이름, 학과, 주소, 학과사무실)
		- 학생성적(학생번호, 강좌이름, 성적)
		- 강의실(강좌이름, 강의실)
	3. 학생학과 릴레이션에서 (학과, 학과사무실)분리
		- 학생(학생번호, 학생이름, 학과, 주소)
		- 학과(학과, 학과 사무실)
		- 학생성적(학생번호, 강좌 이름, 성적)
		- 강의실(강좌이름, 강의실)
![[Pasted image 20240621184227.png]]
- 예제는 생략
## 03) 정규화
- 정규화 과정
- 무손실 분해
- 정규화 정리

### 03-1) 정규화 개념
- 이상현상이 발생하는 릴레이션을 분해 -> 이상현상을 없애는 과정
![[Pasted image 20240621184418.png]]

### 03-2) 정규화 과정
- 이상현상 릴레이션을 분해 -> 이상현상 제거
	- 함수 종속성의 유형에 따라 등급 구분 가능
	- 높을수록 좋음
![[Pasted image 20240621184527.png]]

### 03-3) 제1정규형
- 릴레이션의 R의 모든 속성 값이 원자값을 가짐.
- 제 1 정규형으로 변환
	- 2개 이상의 값을 가짐 -> 1개의 값을 각각 갖도록 분리 -> 제1정규형 완성
고객취미들(이름, 취미들)

| 이름  | 취미들    |
| --- | ------ |
| 김연아 | 인터넷    |
| 추신수 | 영화, 음악 |
| 박세리 | 음악, 쇼핑 |
| 장미란 | 음악     |
| 박지성 | 게임     |
고객취미(이름, 취미)

| 이름  | 취미  |
| --- | --- |
| 김연아 | 인터넷 |
| 추신수 | 영화  |
| 추신수 | 음악  |
| 박세리 | 음악  |
| 박세리 | 쇼핑  |
| 장미란 | 음악  |
| 박지성 | 게임  |

### 03-4) 제2 정규형
- 릴레이션 R이 제 1정규형이고,
	- 기본키가 아닌 속성이 기본키에 완전 함수 종속일때 제2정규형
- 완전 함수 종속(full funcitonal dependency)
	- A와 B가 릴레이션 R의 속성
	- A->B 종속성이 성립 할때!
		- B가 A의 속성 전체에 함수 종속
		- 부분집합 속성에 함수 종속 X -> 완전 함수 종속
- 수강강좌 릴레이션의 예시
	- (학생번호, 강좌이름) -> 성적, 강좌이름 -> 강의실
	- 삭제 이상 : 402번 학생이 수강 취소 -> '스포츠 경영학' 강의실 정보 삭제
	- 삽입이상 : '컴퓨터 입문' 강좌 개설 시 학생번호와 성적을 NULL 로 삽입
	- 수정이상 : '데이터베이스' 강의실 변경 시 데이터 불일치 발생
![[Pasted image 20240621193543.png]]

- 이상현상의 원인 : 부분 함수 종속(partial functional dependency)
	- 강의실이 기본키의 일부인 강좌이름에 종속 (강좌이름 -> 강의실)
	- 완전 함수 종속 = 부분 함수 종속을 모두 제거
![[Pasted image 20240621193657.png]]

- 제2정규형으로 변환
	- 수강강좌 릴레이션에서 이상현상을 일으키는 (강좌이름, 강의실)분해
![[Pasted image 20240621193853.png]]

### 03-5) 제3정규형
- 릴레이션 R이 제2정규형
- 기본키가 아닌 속성이 기본키에 비이행적(non-trasitive)으로 종속할때(직접 종속) 을 말함.
	- 이행적 종속
		- A->B and B-> C 성립 => A->C 도 성립
- 계절학기 릴레이션 예시
	- 학생번호 -> 강좌이름 -> 수강료
	- 삭제 이상 : 402번 학생이 수강 취소 시 -> 스포츠경영학 과목의 수강료 삭제
	- 삽입 이상 : '컴퓨터 입문' 과목이 개설되면 학생 번호가 NULL
	- 수정 이상 : '데이터베이스' 수강료를 변경 시 데이터 불일치 발생 가능
![[Pasted image 20240621194400.png]]

- 제3 정규형으로 변환
	- 계절학기 릴레이션에서 이상현상을 일으키는(강좌이름, 수강료) 를 분해
![[Pasted image 20240621194452.png]]

### 03-6) BCNF(Boyce Codd Normal Form)
- 릴레이션 R에서 함수 종속성 X->Y 가 성립
	- 모든 걸정자 X가 후보키 = BCNF 정규형 이라함.
	- 가정1) 학생은 같은 이름의 특강을 1개만 신청 가능
	- 가정 2) 교수는 1개의 특강을 담당
![[Pasted image 20240621194730.png]]

- 특강수강 릴레이션의 예시
	- 기본키가 아닌 교수가 특강이름을 결정하는 종속관계가 문제
	- 삭제 이상 : 402번 학생이 수강 취소 시 '인간과 동물' 담당 교수 삭제
	- 삽입 이상 : 최교수가 새로운 특강은 아직 학생이 없어 학생번호가 NULL
	- 수정 이상 : 김교수의 특강 제목을 변경 시 데이터 불일치 발생

- BCNF 정규형으로 변환
- 특강수강 릴레이션에서 이상현상을 일으키는 (교수, 특강이름) 분해
![[Pasted image 20240621194947.png]]

### 03-7) 무손실 분해
- 릴레이션 R을 R1과 R2로 분해 할때
	- R1 ⋈ R2 = R이면 무손실 분해(lossless-join decomposition)
	- R1 ∩ R2 → R1 혹은 R1 ∩ R2 → R2 중 하나를 만족

| 구분   | 릴레이션 분해                                                     | 무손실 분해 여부                                                                    |
| ---- | ----------------------------------------------------------- | ---------------------------------------------------------------------------- |
| 분해 1 | 특강수강(학생번호, 특강이름, 교수)<br><br>-> R(학생번호, 교수), R2(교수, 특강이름)    | R1과 R2의 공통 속성은 교수이며, 교수는 R2의 키 이다.<br><br>-> 무손실 분해 규칙을 만족                   |
| 분해 2 | 특강수강(학생번호, 특강이름, 교수)<br><br>-> R3(학생번호, 특강이름), R4(교수, 특강이름) | R3과 R4의 공통 속성은 특강이름이지만, 특강이름 은 R3이나 R4의 키가 아니다.<br><br>-> 무손실 분해 규칙을 만족하지 않음 |
### 03-8) 정규화 정리
![[Pasted image 20240621195440.png]]
- 제 4 정규형 : 다치종속성을 가진 릴레이션에 관한 내용
- 제 5정규형(Project-Join/NF) : 조인 종속성을 가진 릴레이션에 관한것

- 예제 따로 봐라

# 요약
- 이상현상 
	- 잘못 설계된 테이블로 삽입, 삭제, 수정과 같은 작업을 했을때 생기는 현상
	- 데이터베이스의 일관성을 훼손 -> 데이터의 무결성을 깸
	- 이상현상의 종류
		- 삭제이상 : 투플 삭제 시 하나의 정보 삭제 -> 같이 저장된 다른 정보가 연쇄적으로 삭제됨
		- 삽입이상 : 투플 삽입시 제공되지 못하는 속성값을 NULL 값으로 입력해야 하는 현상
		- 수정이상 : 투플 수정 시 중복된 데이터 일부만 수정 -> 데이터의 불일치가 일어나는 현상
		- 
- 함수 종속성
	- 릴레이션 R + R 에 속하는 속성의 집합 X,Y가 있을때,
	   X 각각의 값이 Y 값 한개와 대응될때 'X는 Y' 를 함수적으로 결정한다
	- = X -> Y
- 정규화(Normal Form)
	- 릴레이션을 분해 -> 이상현상 제거
	- 정규화의 종류
		1. 제1정규형(1NF) : 어떤 릴레이션 R의 모든 속성값이 원자값을 가짐
		2. 제2정규형(2NF) : 어떤 릴레이션 R이 제1 정규형이고, 
		   기본키(후보키)가 아닌 속성이 기본키에 ==완전 함수== 종속
		3. 제3정규형(3NF) : 어떤 릴레이션 R이 제2 정규형이고,
		   기본키(후보키)가 이닌 속성이 기본키에 ==비이행적==으로 종속
		4. BCNF(Boyce Codd Normal Form)
			- 함수 종속성 X->Y가 성립할때, 모든 결정자가 X가 후보키이면 BCNF
- 무손실 분해
	- 릴레이션 R을 릴레이션 R1과 R2로 분해 
	  -> R1 ⋈ R2 = R이면 무손실(lossless-join) 분해
	- 무손실 분해를 위한조건
	  -> R1 ∩ R2 → R1이거나 R1 ∩ R2 → R2 중 하나를 만족하면 됨